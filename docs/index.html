<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EventCalendar</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@event-calendar/build@4.5.0/dist/event-calendar.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/@event-calendar/build@4.5.0/dist/event-calendar.min.js"></script>
  <script src="https://hammerjs.github.io/dist/hammer.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    header, footer {
      padding: 8px 16px;
      background: #fff;
    }

    .mode-switcher {
      display: flex;
      justify-content: space-around;
      font-size: 16px;
      padding: 8px 0;
      font-weight: 500;
    }

    .mode-switcher span {
      color: #555;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 16px;
    }

    .mode-switcher .active {
      background: #e0e0e0;
      font-weight: 600;
    }

    .calendar-title {
      font-size: 22px;
      font-weight: 600;
      padding: 4px 16px;
    }

    .calendar-subtitle {
      font-size: 14px;
      padding-left: 16px;
      color: #999;
    }

    .month-footer {
      display: flex;
      justify-content: space-around;
      font-size: 15px;
      padding: 8px 0;
    }

    .month-footer span {
      color: #666;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 12px;
    }

    .month-footer .active {
      background: #111;
      color: #fff;
    }

    #ec {
      width: 100%;
      height: calc(100vh - 200px);
    }

    .day-footer {
      display: flex;
      justify-content: space-between;
      font-size: 15px;
      padding: 8px 16px;
    }

    .day-footer span {
      width: 32px;
      text-align: center;
      padding: 6px 0;
      border-radius: 20px;
      color: #999;
      cursor: pointer;
    }

    .day-footer .active {
      background: red;
      color: white;
    }
  </style>
</head>
<body>
  <header>
    <div class="mode-switcher" id="modeSwitcher">
      <span data-view="listWeek">List</span>
      <span data-view="resourceTimeGridDay">Day</span>
      <span data-view="resourceTimeGridWeek">Week</span>
      <span data-view="dayGridMonth" class="active">Month</span>
      <span data-view="resourceTimelineWeek">Planner</span>
    </div>
    <div class="calendar-title" id="calendarTitle">July 2025</div>
    <div class="calendar-subtitle" id="calendarSubtitle"></div>
  </header>

  <main>
    <div id="ec"></div>
  </main>

  <footer>
    <div class="month-footer" id="monthFooter">
      <span>Apr</span><span>May</span><span>Jun</span><span class="active">Jul</span><span>Aug</span><span>Sep</span><span>Oct</span>
    </div>
    <div class="day-footer" id="dayFooter" style="display: none;">
      <span>Mon</span><span>Tue</span><span>Wed</span><span>Thu</span><span>Fri</span><span>Sat</span><span>Sun</span>
    </div>
  </footer>

  <script>
    let touchStartX = 0;
    let touchEndX = 0;
    let blockTap = false;
    let lastClickedDate = null;
    let lastTapTime = 0;

    const ec = EventCalendar.create(document.getElementById("ec"), {
      view: "dayGridMonth",
      firstDay: 1,
      timeFormat: 'H:mm',
      headerToolbar: false,
      height: "100%",
      resources: [
        { id: 1, title: "–ù–∞—Ç–∞–ª—å—è" },
        { id: 2, title: "–ò—Ä–∏–Ω–∞" },
      ],
      events: createEvents(),
      nowIndicator: true,
      selectable: true,
      dayMaxEvents: true,
      scrollTime: "08:00:00",
      views: {
        timeGridWeek: { pointer: true },
        resourceTimeGridWeek: { pointer: true },
        resourceTimelineWeek: {
          slotDuration: "00:15",
          slotLabelInterval: "01:00",
          slotMinTime: "09:00",
          slotMaxTime: "21:00",
          slotWidth: 16,
        },
      },
      dateClick(info) {
        lastClickedDate = info.dateStr;
        lastTapTime = Date.now();
      },
    });

    const calendarEl = document.getElementById("ec");
    const hammer = new Hammer(calendarEl);
    hammer.get("doubletap").set({ interval: 300 });

    hammer.on("doubletap", function () {
      if (lastClickedDate && Date.now() - lastTapTime < 600) {
        ec.setOption("date", lastClickedDate);
        ec.setOption("view", "resourceTimeGridDay");
        updateActiveMode("resourceTimeGridDay");
        updateTitle();
      }
    });

    document.addEventListener("touchstart", e => {
      touchStartX = e.changedTouches[0].screenX;
    });

    document.addEventListener("touchend", e => {
      touchEndX = e.changedTouches[0].screenX;
      let delta = touchEndX - touchStartX;
      if (Math.abs(delta) > 50) {
        blockTap = true;
        setTimeout(() => blockTap = false, 400);
        if (delta > 0) ec.prev();
        else ec.next();
        updateTitle();
      }
    });

    document.getElementById("modeSwitcher").addEventListener("click", (e) => {
      if (e.target.dataset.view) {
        ec.setOption("view", e.target.dataset.view);
        updateActiveMode(e.target.dataset.view);
        updateTitle();
      }
    });

    document.getElementById("dayFooter").addEventListener("click", (e) => {
      if (e.target.tagName === "SPAN") {
        const offset = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].indexOf(e.target.textContent);
        const baseDate = new Date(ec.getOption("date"));
        const currentWeekday = (baseDate.getDay() + 6) % 7; // 0=Mon
        const diff = offset - currentWeekday;
        baseDate.setDate(baseDate.getDate() + diff);
        const iso = baseDate.toISOString().slice(0, 10);
        ec.setOption("date", iso);
        ec.setOption("view", "resourceTimeGridDay");
        updateActiveMode("resourceTimeGridDay");
        updateTitle();
      }
    });

    function updateActiveMode(viewName) {
      document.querySelectorAll("#modeSwitcher span").forEach(el => {
        el.classList.toggle("active", el.dataset.view === viewName);
      });
      document.getElementById("dayFooter").style.display = viewName === "resourceTimeGridDay" ? "flex" : "none";
    }

    function updateTitle() {
      const dateStr = ec.getOption("date");
      const date = new Date(dateStr);
      const view = ec.getOption("view");

      const month = date.toLocaleString('default', { month: 'long' });
      const year = date.getFullYear();
      const dow = date.toLocaleString('default', { weekday: 'long' });
      const day = date.getDate();

      if (view === "resourceTimeGridDay") {
        document.getElementById("calendarTitle").textContent = `${dow}, ${day} ${month}`;
        document.getElementById("calendarSubtitle").textContent = `Week ${getWeekNumber(date)}`;
        updateDayFooter(date);
      } else {
        document.getElementById("calendarTitle").textContent = `${month} ${year}`;
        document.getElementById("calendarSubtitle").textContent = ``;
      }
    }

    function updateDayFooter(date) {
      const dayIndex = date.getDay(); // 0=Sun ... 6=Sat
      const ordered = [1, 2, 3, 4, 5, 6, 0]; // Mon‚ÄìSun
      document.querySelectorAll("#dayFooter span").forEach((el, i) => {
        el.classList.toggle("active", ordered[i] === dayIndex);
      });
    }

    function getWeekNumber(d) {
      d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
      d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
      const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
      return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
    }

    function createEvents() {
      const today = new Date().toISOString().slice(0, 10);
      return [
        {
          start: today + "T08:39:00",
          end: today + "T10:39:00",
          title: "–ù–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ: Full Colour Short",
          resourceId: 1,
          color: "#2e8b57",
        },
        {
          start: today + "T08:39:00",
          end: today + "T10:39:00",
          title: "Full Colour Short: Leonid Zadoroznyj",
          resourceId: 2,
          color: "#4682b4",
        },
        {
          start: today,
          title: "üíµ –ó–∞—Ä–ø–ª–∞—Ç–∞",
          allDay: true,
          resourceId: 2,
          color: "#8888ff"
        }
      ];
    }

    updateTitle();
  </script>
</body>
</html>
