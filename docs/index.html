<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EventCalendar</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@event-calendar/build@4.5.0/dist/event-calendar.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/@event-calendar/build@4.5.0/dist/event-calendar.min.js"></script>
  <script src="https://hammerjs.github.io/dist/hammer.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #fff;
      color: #000;
    }

    header, footer {
      padding: 8px 16px;
      background: #fff;
    }

    .mode-switcher {
      display: flex;
      justify-content: space-around;
      font-size: 16px;
      padding: 8px 0;
      font-weight: 500;
    }

    .mode-switcher span {
      color: #555;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 16px;
    }

    .mode-switcher .active {
      background: #e0e0e0;
      font-weight: 600;
    }

    .calendar-title {
      font-size: 22px;
      font-weight: 600;
      padding: 4px 16px;
    }

    .calendar-subtitle {
      font-size: 14px;
      padding-left: 16px;
      color: #999;
    }

    .month-footer {
      display: flex;
      justify-content: space-around;
      font-size: 15px;
      padding: 8px 0;
    }

    .month-footer span {
      color: #666;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 12px;
    }

    .month-footer .active {
      background: #111;
      color: #fff;
    }

    #ec {
      width: 100%;
      height: calc(100vh - 200px);
    }

    .day-footer {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      padding: 8px 16px;
    }

    .day-footer span {
      flex: 1;
      text-align: center;
      padding: 6px 0;
      border-radius: 20px;
      color: #999;
      cursor: pointer;
      white-space: nowrap;
    }

    .day-footer .active {
      background: red;
      color: white;
    }
  </style>
</head>
<body>
  <header>
    <div class="mode-switcher" id="modeSwitcher">
      <span data-view="listWeek">List</span>
      <span data-view="resourceTimeGridDay">Day</span>
      <span data-view="resourceTimeGridWeek">Week</span>
      <span data-view="dayGridMonth" class="active">Month</span>
      <span data-view="resourceTimelineWeek">Planner</span>
    </div>
    <div class="calendar-title" id="calendarTitle">July 2025</div>
    <div class="calendar-subtitle" id="calendarSubtitle"></div>
  </header>

  <main>
    <div id="ec"></div>
  </main>

  <footer>
    <div class="month-footer" id="monthFooter">
      <span>Apr</span><span>May</span><span>Jun</span><span class="active">Jul</span><span>Aug</span><span>Sep</span><span>Oct</span>
    </div>
    <div class="day-footer" id="dayFooter" style="display: none;">
      <span>Mon</span><span>Tue</span><span>Wed</span><span>Thu</span><span>Fri</span><span>Sat</span><span>Sun</span>
    </div>
  </footer>

  <script>
    let touchStartX = 0;
    let touchEndX = 0;
    let lastClickedDate = null;
    let lastTapTime = 0;

    const ec = EventCalendar.create(document.getElementById("ec"), {
      view: "dayGridMonth",
      firstDay: 1,
      timeFormat: 'H:mm',
      headerToolbar: false,
      height: "100%",
      resources: [
        { id: 1, title: "–ù–∞—Ç–∞–ª—å—è" },
        { id: 2, title: "–ò—Ä–∏–Ω–∞" },
      ],
      events: createEvents(),
      nowIndicator: true,
      selectable: true,
      dayMaxEvents: true,
      scrollTime: "08:00:00",
    });

    const calendarEl = document.getElementById("ec");
    const hammer = new Hammer(calendarEl);
    hammer.get("doubletap").set({ interval: 300 });

    hammer.on("doubletap", function () {
      if (lastClickedDate && Date.now() - lastTapTime < 600) {
        ec.setOption("date", lastClickedDate);
        ec.setOption("view", "resourceTimeGridDay");
        updateActiveMode("resourceTimeGridDay");
        updateTitle();
      }
    });

    document.addEventListener("touchstart", e => {
      touchStartX = e.changedTouches[0].screenX;
    });

    document.addEventListener("touchend", e => {
      touchEndX = e.changedTouches[0].screenX;
      let delta = touchEndX - touchStartX;
      if (Math.abs(delta) > 50) {
        if (delta > 0) ec.prev();
        else ec.next();
        updateTitle();
      }
    });

    document.getElementById("modeSwitcher").addEventListener("click", (e) => {
      if (e.target.dataset.view) {
        ec.setOption("view", e.target.dataset.view);
        updateActiveMode(e.target.dataset.view);
        updateTitle();
      }
    });

    document.getElementById("dayFooter").addEventListener("click", (e) => {
      if (e.target.tagName === "SPAN" && e.target.dataset.date) {
        ec.setOption("date", e.target.dataset.date);
        ec.setOption("view", "resourceTimeGridDay");
        updateActiveMode("resourceTimeGridDay");
        updateTitle();
      }
    });

    ec.setOption("dateClick", function(info) {
      lastClickedDate = info.dateStr;
      lastTapTime = Date.now();
    });

    function updateActiveMode(viewName) {
      document.querySelectorAll("#modeSwitcher span").forEach(el => {
        el.classList.toggle("active", el.dataset.view === viewName);
      });
      document.getElementById("dayFooter").style.display = viewName === "resourceTimeGridDay" ? "flex" : "none";
      document.getElementById("monthFooter").style.display = viewName === "resourceTimeGridDay" ? "none" : "flex";
    }

    function updateTitle() {
      const dateStr = ec.getOption("date");
      const date = new Date(dateStr);
      const view = ec.getOption("view");

      const day = date.getDate();
      const dow = date.toLocaleString('default', { weekday: 'short' });
      const monthShort = date.toLocaleString('default', { month: 'short' });

      if (view === "resourceTimeGridDay") {
        document.getElementById("calendarTitle").textContent = `${dow}, ${day} ${monthShort}`;
        document.getElementById("calendarSubtitle").textContent = `Week ${getWeekNumber(date)}`;
        updateDayFooterWithDates(date);
      } else {
        const month = date.toLocaleString('default', { month: 'long' });
        const year = date.getFullYear();
        document.getElementById("calendarTitle").textContent = `${month} ${year}`;
        document.getElementById("calendarSubtitle").textContent = ``;
      }
    }

    function updateDayFooterWithDates(date) {
      const startOfWeek = new Date(date);
      startOfWeek.setDate(date.getDate() - ((date.getDay() + 6) % 7)); // Monday
      const spans = document.querySelectorAll("#dayFooter span");

      spans.forEach((el, i) => {
        const d = new Date(startOfWeek);
        d.setDate(d.getDate() + i);
        const dow = d.toLocaleString('default', { weekday: 'short' });
        const day = d.getDate();
        el.textContent = `${dow} ${day}`;
        el.dataset.date = d.toISOString().slice(0, 10);
        el.classList.toggle("active", d.toDateString() === date.toDateString());
      });
    }

    function getWeekNumber(d) {
      d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
      d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
      const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
      return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
    }

    function createEvents() {
      const today = new Date().toISOString().slice(0, 10);
      return [
        {
          start: today + "T08:39:00",
          end: today + "T10:39:00",
          title: "–ù–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ: Full Colour Short",
          resourceId: 1,
          color: "#2e8b57",
        },
        {
          start: today + "T08:39:00",
          end: today + "T10:39:00",
          title: "Full Colour Short: Leonid Zadoroznyj",
          resourceId: 2,
          color: "#4682b4",
        },
        {
          start: today,
          title: "üíµ –ó–∞—Ä–ø–ª–∞—Ç–∞",
          allDay: true,
          resourceId: 2,
          color: "#8888ff"
        }
      ];
    }

    updateTitle();
  </script>
</body>
</html>
