<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EventCalendar Double Tap</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@event-calendar/build@4.5.0/dist/event-calendar.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/@event-calendar/build@4.5.0/dist/event-calendar.min.js"></script>
  <style>
    .ec-timeline .ec-time,
    .ec-timeline .ec-line {
      width: 16px;
    }
    .ec-timeline .ec-time {
      overflow: visible;
    }
    .ec-timeline .ec-time time {
      display: inline-block;
      width: 64px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div id="ec"></div>

  <script>
    const ec = EventCalendar.create(document.getElementById("ec"), {
      view: "dayGridMonth",
      headerToolbar: {
        start: "prev,next today",
        center: "title",
        end:
          "dayGridMonth,timeGridWeek,timeGridDay,listWeek resourceTimeGridWeek,resourceTimelineWeek",
      },
      resources: [
        { id: 1, title: "Наталья" },
        { id: 2, title: "Ирина" },
      ],
      scrollTime: "09:00:00",
      events: [
        // твои события тут
      ],
      dayMaxEvents: true,
      nowIndicator: true,
      selectable: true,
    });

    let lastTapTime = 0;
    let lastTapDate = null;
    let tapTimeout;

    // Функция обработчик для двойного тапа
    function onDayDoubleTap(dateStr) {
      // Переключаемся на day view для выбранной даты
      ec.setOption("date", dateStr);
      ec.setOption("view", "resourceTimeGridDay");
      console.log("Double tap on date:", dateStr);
    }

    // Отслеживаем касания по ячейкам месяца
    document.getElementById("ec").addEventListener("touchend", (e) => {
      // Проверяем, что тапнули именно по дню месяца (ячейке)
      const dayEl = e.target.closest(".ec-day:not(.ec-other)");

      if (!dayEl) return;

      const dateStr = dayEl.getAttribute("data-date");
      if (!dateStr) return;

      const now = Date.now();

      if (lastTapDate === dateStr && now - lastTapTime < 400) {
        // Если второй тап в том же дне и за 400мс - двойной тап
        clearTimeout(tapTimeout); // Отменяем ожидание одиночного тапа
        lastTapTime = 0;
        lastTapDate = null;

        onDayDoubleTap(dateStr);
      } else {
        // Первый тап - запускаем таймер ожидания, что это одиночный тап
        lastTapTime = now;
        lastTapDate = dateStr;

        tapTimeout = setTimeout(() => {
          // Одиночный тап (если нужно - сюда добавлять обработчик)
          lastTapTime = 0;
          lastTapDate = null;
          // Если нужен одиночный тап, обработай здесь
        }, 400);
      }
    });
  </script>
</body>
</html>
